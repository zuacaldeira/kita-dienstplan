<div class="dashboard">
  <!-- Material Toolbar Header -->
  <mat-toolbar color="primary" class="dashboard-toolbar" role="banner">
    <mat-icon aria-hidden="true">school</mat-icon>
    <span class="toolbar-title">Kita Casa Azul</span>
    <span class="spacer"></span>
    <button mat-icon-button
            (click)="toggleTheme()"
            [attr.aria-label]="themeService.isDarkMode() ? 'Zum hellen Modus wechseln' : 'Zum dunklen Modus wechseln'"
            [attr.aria-pressed]="themeService.isDarkMode()"
            title="{{ themeService.isDarkMode() ? 'Heller Modus' : 'Dunkler Modus' }}">
      <mat-icon>{{ themeService.isDarkMode() ? 'light_mode' : 'dark_mode' }}</mat-icon>
    </button>
    <button mat-button
            [matMenuTriggerFor]="userMenu"
            aria-label="Benutzermenü öffnen"
            aria-haspopup="true">
      <mat-icon aria-hidden="true">account_circle</mat-icon>
      <span class="user-name">{{ currentUser?.fullName }}</span>
      <mat-icon aria-hidden="true">arrow_drop_down</mat-icon>
    </button>
    <mat-menu #userMenu="matMenu">
      <button mat-menu-item disabled>
        <mat-icon>person</mat-icon>
        <span>{{ currentUser?.username }}</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Abmelden</span>
      </button>
    </mat-menu>
  </mat-toolbar>

  <!-- Material Tabs -->
  <mat-tab-group class="dashboard-tabs"
                 (selectedIndexChange)="onTabChange($event)"
                 role="navigation"
                 aria-label="Hauptnavigation">
    <!-- Overview Tab -->
    <mat-tab label="Übersicht" aria-label="Übersicht Seite">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon" aria-hidden="true">dashboard</mat-icon>
        Übersicht
      </ng-template>
      <div class="tab-content overview-tab">
        <h2 class="section-title">Dashboard</h2>

        <!-- Loading Skeleton -->
        <app-skeleton-stats *ngIf="loading"></app-skeleton-stats>

        <!-- Stats Cards -->
        <div *ngIf="!loading">
          <div class="stats-grid">
            <mat-card class="stat-card">
              <mat-card-content>
                <div class="stat-icon-container">
                  <mat-icon color="primary" class="stat-icon-large">people</mat-icon>
                </div>
                <div class="stat-value">{{ stats.activeStaff }}</div>
                <div class="stat-label">Aktive Mitarbeiter</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="stat-card">
              <mat-card-content>
                <div class="stat-icon-container">
                  <mat-icon color="primary" class="stat-icon-large">business</mat-icon>
                </div>
                <div class="stat-value">{{ stats.groups }}</div>
                <div class="stat-label">Altersgruppen</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="stat-card">
              <mat-card-content>
                <div class="stat-icon-container">
                  <mat-icon color="primary" class="stat-icon-large">calendar_today</mat-icon>
                </div>
                <div class="stat-value">{{ stats.currentWeek }}</div>
                <div class="stat-label">Aktuelle Woche</div>
              </mat-card-content>
            </mat-card>
          </div>

            <!-- Quick Actions -->
            <mat-card class="quick-actions-card">
              <mat-card-header>
                <mat-card-title>Schnellaktionen</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="actions-grid">
                  <button mat-raised-button color="primary" (click)="openScheduleEntryDialog()">
                    <mat-icon>add</mat-icon>
                    Neuen Dienstplan erstellen
                  </button>
                  <button mat-raised-button color="primary" (click)="openStaffDialog()">
                    <mat-icon>person_add</mat-icon>
                    Mitarbeiter hinzufügen
                  </button>
                  <button mat-raised-button color="primary" disabled>
                    <mat-icon>assessment</mat-icon>
                    Wochenübersicht anzeigen
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
      </div>
    </mat-tab>

    <!-- Schedule Tab -->
    <mat-tab label="Dienstplan" aria-label="Dienstplan Seite">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon" aria-hidden="true">calendar_month</mat-icon>
        Dienstplan
      </ng-template>
      <div class="tab-content schedule-tab">
        <!-- Week Navigation -->
        <div class="schedule-header">
          <h2 class="section-title">Dienstplan</h2>
          <div class="week-selector">
            <button mat-icon-button (click)="previousWeek()" aria-label="Vorherige Woche">
              <mat-icon>chevron_left</mat-icon>
            </button>
            <span class="week-display">KW {{ currentWeek }} / {{ currentYear }}</span>
            <button mat-icon-button (click)="nextWeek()" aria-label="Nächste Woche">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
        </div>

        <!-- Empty State - only show when explicitly no schedule data -->
        <mat-card *ngIf="scheduleEntries.length === 0" class="empty-state-card">
          <mat-card-content>
            <mat-icon class="empty-icon">event_busy</mat-icon>
            <p>Kein Dienstplan für diese Woche vorhanden</p>
            <button mat-raised-button color="primary" (click)="openScheduleEntryDialog()">
              <mat-icon>add</mat-icon>
              Dienstplan erstellen
            </button>
          </mat-card-content>
        </mat-card>

        <!-- Schedule Table View -->
        <app-schedule-table
          *ngIf="scheduleEntries.length > 0"
          [scheduleEntries]="scheduleEntries"
          [currentWeek]="currentWeek"
          [currentYear]="currentYear"
          (editEntry)="openScheduleEntryDialog($event)"
          (deleteEntry)="openDeleteScheduleEntryConfirm($event)"
          (createEntry)="onCreateScheduleEntry($event)">
        </app-schedule-table>
      </div>
    </mat-tab>

    <!-- Staff Tab -->
    <mat-tab label="Mitarbeiter" aria-label="Mitarbeiter Seite">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon" aria-hidden="true">people</mat-icon>
        Mitarbeiter
      </ng-template>
      <div class="tab-content staff-tab">
        <div class="tab-header">
          <h2 class="section-title">Mitarbeiter</h2>
          <button mat-raised-button color="primary" (click)="openStaffDialog()">
            <mat-icon>person_add</mat-icon>
            Neuer Mitarbeiter
          </button>
        </div>

        <!-- Loading Skeleton - show while staff array is empty -->
        <div *ngIf="staff.length === 0" class="staff-loading">
          <app-skeleton-card *ngFor="let i of [1,2,3,4,5]"
                             [height]="140"
                             [showAvatar]="true"
                             [showContent]="true"
                             [contentLinesCount]="3">
          </app-skeleton-card>
        </div>

        <!-- Staff List - show when we have staff data -->
        <div class="staff-list" *ngIf="staff.length > 0">
          <mat-card *ngFor="let person of staff" class="staff-card">
            <mat-card-content>
              <div class="staff-card-layout">
                <div class="staff-info">
                  <h3>{{ person.fullName }}</h3>
                  <p class="staff-detail">
                    <mat-icon>work</mat-icon>
                    {{ person.role }}
                  </p>
                  <p class="staff-detail">
                    <mat-icon>schedule</mat-icon>
                    {{ person.employmentType }}
                  </p>
                  <p class="staff-detail" *ngIf="person.weeklyHours">
                    <mat-icon>access_time</mat-icon>
                    {{ person.weeklyHours }} Std./Woche
                  </p>
                </div>
                <div class="staff-actions">
                  <button mat-icon-button (click)="openStaffDialog(person)"
                          aria-label="Mitarbeiter bearbeiten"
                          title="Bearbeiten">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button (click)="openDeleteStaffConfirm(person)"
                          aria-label="Mitarbeiter löschen"
                          title="Löschen"
                          color="warn">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Groups Tab -->
    <mat-tab label="Altersgruppen" aria-label="Altersgruppen Seite">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon" aria-hidden="true">business</mat-icon>
        Altersgruppen
      </ng-template>
      <div class="tab-content groups-tab">
        <div class="tab-header">
          <h2 class="section-title">Altersgruppen</h2>
          <button mat-raised-button color="primary" (click)="openGroupDialog()">
            <mat-icon>add</mat-icon>
            Neue Gruppe
          </button>
        </div>

        <!-- Loading Skeleton - show while groups array is empty -->
        <div class="groups-grid" *ngIf="groups.length === 0">
          <app-skeleton-card *ngFor="let i of [1,2,3,4]"
                             [height]="180"
                             [showAvatar]="false"
                             [showContent]="true"
                             [contentLinesCount]="4">
          </app-skeleton-card>
        </div>

        <!-- Groups Grid - show when we have groups data -->
        <div class="groups-grid" *ngIf="groups.length > 0">
          <mat-card *ngFor="let group of groups" class="group-card">
            <mat-card-header>
              <mat-card-title>{{ group.name }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p>{{ group.description }}</p>
            </mat-card-content>
            <mat-card-actions>
              <button mat-button (click)="openGroupDialog(group)">
                <mat-icon>edit</mat-icon>
                Bearbeiten
              </button>
              <button mat-button color="warn" (click)="openDeleteGroupConfirm(group)">
                <mat-icon>delete</mat-icon>
                Löschen
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
